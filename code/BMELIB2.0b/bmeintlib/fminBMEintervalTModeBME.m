function [f,INFOINTEG]=fminBMEintervalModeTBME(zk,zh,a,b,invKkhkh,KskhinvKkhkh,Kssifkh,zfile,dgfile,options);% fminBMEintervalTModeBME   - fminbnd subroutine for BMEintervalTMode.m, BME case (Jan 1,2001)%% Objective function used by BMEintervalTMode.m for the% BME case in order to identify the mode of the posterior% probability distribution function on the original scale% (see BMEintervalTMode.m).%% SYNTAX :%% [f,INFOINTEG]=fminBMEintervalModeTBME(zk,zh,a,b,invKkhkh,KskhinvKkhkh,Kssifkh,zfile,dgfile,options);%% INPUT :%% zk             scalar          value for which the posterior pdf is computed % zh             nh by 1         vector of conditioning values hard values.% a              ns by 1         vector of lower integration limits.% b              ns by 1         vector of upper integration limits.% invKkhkh       nk+nh by nk+nh  inverse of the covariance matrix for the%                                estimation location and the hard data.% KskhinvKkhkh   ns+1            vector equal to Kskh*inv(Kkhkh), where Kskh and%                                Kkhkh are covariance matrices.% Kssifkh        ns by ns        matrix of conditional covariances for the soft%                                data given zk and zh.% zfile          nz by 1         vector of values on the Gaussian scale.% dgfile         nz by 1         vector of values for the derivative of the transform%                                at the values specified in zfile.% options        1 by 14         vector of parameters as described in BMEintervalTMode.m%% OUTPUT :%% f              scalar          value of -log(pdf) up to some constants.% INFOINTEG      scalar          information returned by the Fortran integration%                                subroutine mvnAG1.global INFOINTEG                    % declares INFOTEG as global, so it can be used				    % in the main programzkh=[zk;zh];msifkh=KskhinvKkhkh*zkh;            % compute the conditional mean[P,evalerr,INFOINTEG]=mvnAG1(a-msifkh,b-msifkh,Kssifkh,options(3),0,options(4));P=max([P,1e-323]);                  % make sure that log(P) does not yield -Inff=0.5*(zkh'*invKkhkh*zkh)-log(P);   % compute the value of the posterior pdfdg=interp1(zfile,dgfile,zk);f=f+log(dg);