function [P]=intBMEinterval(z2,a,b,K12invK22,K11if2,options);% intBMEinterval            - integration subroutine for BMEinterval*.m (Jan 1,2001)%% Integration subroutine computing the integral of a% conditional multivariate zero-mean Gaussian distribution.% The distribution to be integrated is Z1 given z2,% where Z1 is a vector of zero-mean Gaussian variables.%% SYNTAX :%% [P]=intBMEinterval(z2,a,b,K12invK22,K11if2,options);%% INPUT :%% z2          n2 by 1        vector of conditioning values.% a2          n2 by 1        vector of lower bounds of the intervals for the%                            vector of conditioning variables z2.% b2          n2 by 1        vector of upper bounds of the intervals for the%                            vector of conditioning variables z2.% K12invK22   n1 by 1        vector equal to K12*inv(K22), where K12 and K22%                            are covariance matrices.% K11if2      n1 by n1       matrix of conditional covariances given the values%                            for the z2 variables.% options     1 by 4 or 14   vector of optional parameters, where :%                            options(3) is the maximum number of evaluation of%                            the integral (default value is 50000).%                            options(4) is the relative error on the estimation%                            of the integral (default value is 1e-4).%                            The other values of options are not used.%% OUTPUT :%% P            scalar        probability equal to the integral of the%                            distribution over the intervals [a,b].global INFOINTEGif isempty(z2),                 % test for the existence of conditioning values   m1if2=0;                      % conditional mean is m1if2=m1=0 when z2=[]else  m1if2=K12invK22*z2;           % compute the conditional mean otherwise where m1=0end;[P,evalerr,INFOINTEG]=mvnAG1(a-m1if2,b-m1if2,K11if2,options(3),0,options(4));P=max([P,1e-323]);              % make sure that P does not yield 0 