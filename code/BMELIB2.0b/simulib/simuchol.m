function [Zh,L]=simuchol(ch,covmodel,covparam,ns);% simuchol                  - simulation by the Cholesky method (Jan 1,2001)%% Implementation of the traditional non conditional% simulation method based on a Choleski decomposition% of the covariance matrix. This simulation method is% especially recommended for simulating independantly% several sets of a limited number of hard values% (less than few hundreds). Simulated values are zero% mean Gaussian distributed. %% SYNTAX :%% [Zh,L]=simuchol(ch,covmodel,covparam,ns);%% INPUT :%% ch         nh by d   matrix of coordinates for the locations%                      where hard data have to be simulated. A%                      line corresponds to the vector of coordinates%                      at a simulation location, so the number of%                      columns corresponds to the dimension of the%                      space. There is no restriction on the dimension%                      of the space.% covmodel   string    string that contains the name of the covariance%                      model which is used for the simulation (see the%                      MODELS directory). Variogram models are not%                      available for this function.% covparam   1 by k    vector of values for the parameters of covmodel,%                      according to the convention for the corresponding%                      covariance model.% ns         scalar    number of sets of simulated values which are required.%                      If the optional ns variable is omitted from the input%                      list of variables, simuchol.m produces a single set%                      of simulated values.% % OUTPUT :%% Zh         nh by ns  matrix of zero mean simulated Gaussian distributed hard%                      values at the coordinates specified in ch. Each column%                      corresponds to a different simulation, so that if ns=1%                      or if ns is omitted, Zh is a column vector of values.%                      Each simulated vector of values is statistically%                      independant from the others.% L          nh by nh  upper triangular matrix obtained from the Choleski%                      decomposition of the global covariance matrix C for%                      values at the ch coordinates, such that C=L'*L.%% NOTE :%% All the specific conventions for specifying nested models,% multivariate or space-time cases are the same as for kriging.m.if nargin<4,  ns=1;end;[K]=coord2K(ch,ch,covmodel,covparam);L=chol(K);Lt=L';n=size(Lt,1);Zh=zeros(n,ns);for i=1:ns,   Zh(:,i)=Lt*randn(n,1); end;